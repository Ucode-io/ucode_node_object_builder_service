syntax="proto3";

package object_builder_service;
option go_package="genproto/object_builder_service";

import "google/protobuf/struct.proto";
import "google/protobuf/empty.proto";
import "object_builder.proto";
import "google/protobuf/any.proto";


service PermissionService {
    rpc UpsertPermissionsByAppId(UpsertPermissionsByAppIdRequest) returns (UpsertPermissionsByAppIdResponse) {}
    rpc GetAllPermissionsByRoleId (GetAllPermissionRequest) returns (CommonMessage) {}
    rpc GetFieldPermissions (GetFieldPermissionRequest) returns (CommonMessage) {}
    rpc GetActionPermissions (GetActionPermissionRequest) returns (CommonMessage) {}
    rpc GetViewRelationPermissions (GetActionPermissionRequest) returns (CommonMessage) {}
    rpc GetListWithRoleAppTablePermissions(GetListWithRoleAppTablePermissionsRequest) returns (GetListWithRoleAppTablePermissionsResponse) {}
    rpc UpdateRoleAppTablePermissions(UpdateRoleAppTablePermissionsRequest) returns (google.protobuf.Empty) {}
    rpc GetAllMenuPermissions(GetAllMenuPermissionsRequest) returns (GetAllMenuPermissionsResponse) {}
    rpc UpdateMenuPermissions(UpdateMenuPermissionsRequest) returns (google.protobuf.Empty) {}
    rpc UpdatePermissionsByTableSlug(UpdatePermissionsRequest) returns (google.protobuf.Empty) {}
    rpc GetPermissionsByTableSlug(GetPermissionsByTableSlugRequest) returns (GetPermissionsByTableSlugResponse) {}
    rpc GetGlobalPermissionByRoleId(GetGlobalPermissionsByRoleIdRequest) returns (GlobalPermission) {}
    rpc GetTablePermission(GetTablePermissionRequest) returns (GetTablePermissionResponse) {}
}

message GetGlobalPermissionsByRoleIdRequest {
    string project_id = 1;
    string role_id = 2;
}

message GetAllPermissionRequest {
    string role_id = 1;
    string project_id = 2;
}

message GetFieldPermissionRequest {
    string role_id = 1;
    string table_slug = 2;
    string project_id = 3;
    string version_id = 4;
}

message UpsertPermissionsByAppIdResponse{
    string app = 1;
    google.protobuf.Struct data = 2;
}
message UpsertPermissionsByAppIdRequest {
    string app_id = 1;
    google.protobuf.Struct data = 2;
    string project_id = 3;
}

message GetActionPermissionRequest {
    string role_id = 1;
    string table_slug = 2;
    string project_id = 3;
}

message GetListWithRoleAppTablePermissionsRequest {
    string project_id = 1;
    string role_id = 2;
    string version_id = 3;
}

message RoleWithAppTablePermissions {
    
    message Table {
        message RecordPermission {
            string read = 1;
            string write = 2;
            string update = 3;
            string delete = 4;
            string guid = 5;
            bool is_have_condition = 6;
            bool is_public = 7;
        }
        message FieldPermission {
            string field_id = 1;
            string guid = 2;
            bool view_permission = 3;
            bool edit_permission = 4;
            string label = 5;
            string table_slug = 6;
            google.protobuf.Struct attributes = 7;
        }
        message ViewPermission {
            string guid = 1;
            string label = 2;
            string relation_id = 3;
            bool view_permission = 4;
            bool edit_permission = 5;
            bool create_permission = 6;
            bool delete_permission = 7;
            string table_slug = 8;
            google.protobuf.Struct attributes = 9;
        }
        message AutomaticFilter {
            string guid = 1;
            string object_field = 2;
            string custom_field = 3;
            string table_slug = 4;
            bool not_use_in_tab = 5;
        }
        message ActionPermission {
            string guid = 1;
            string custom_event_id = 2;
            bool permission = 3;
            string label = 4;
            string table_slug = 5;
            google.protobuf.Struct attributes = 6;
        }
        message AutomaticFilterWithMethod {
            repeated AutomaticFilter read = 1;
            repeated AutomaticFilter write = 2;
            repeated AutomaticFilter update = 3;
            repeated AutomaticFilter delete = 4;
        }
        message TableViewPermission {
            string guid = 1;
            string name = 2;
            bool view = 3;
            bool edit = 4;
            bool delete = 5;
            string view_id = 6;
            google.protobuf.Struct attributes = 7;
        }
        message CustomPermission {
            string view_create = 1;
            string share_modal = 2;
            string settings = 3;
            string automation = 4;
            string language_btn = 5;
        }

        string label = 1;
        string slug = 2;
        string description = 3;
        bool show_in_menu = 4;
        bool is_changed = 5;
        string icon = 6;
        string subtitle_field_slug = 7;
        bool with_increment_id = 8;
        int32 digit_number = 9;
        string id = 10;
        RecordPermission record_permissions = 11;
        repeated FieldPermission field_permissions = 12;
        repeated ViewPermission view_permissions = 13;
        AutomaticFilterWithMethod automatic_filters = 14;
        repeated ActionPermission action_permissions = 15;
        repeated TableViewPermission table_view_permissions = 16;
        CustomPermission custom_permission = 17;
        google.protobuf.Struct attributes = 18;
    }
    string name = 1;
    string guid = 2;
    string project_id = 3;
    string client_platform_id = 4;
    string client_type_id = 5;
    bool grant_access = 6;
    repeated Table tables = 7;
    GlobalPermission global_permission = 8;
}

message GlobalPermission {
    string id = 1;
    bool menu_button = 2;
    bool chat = 3;
    bool settings_button = 4;
    bool project_settings_button = 5;
    bool profile_settings_button = 6;
    bool menu_setting_button = 7;
    bool redirects_button = 8;
    bool api_keys_button = 9;
    bool environments_button = 10;
    bool projects_button = 11;
    bool environment_button = 12;
    bool version_button = 13;
    bool project_button = 14;
    bool sms_button = 15;
}

message GetListWithRoleAppTablePermissionsResponse {
    string project_id = 1;
    RoleWithAppTablePermissions data = 2;
}

message UpdateRoleAppTablePermissionsRequest {
    string project_id = 1;
    RoleWithAppTablePermissions data = 2;
}

message MenuPermission {
    message Permission { 
        bool read = 2;
        bool write = 3;
        bool update = 4;
        bool delete = 5;
        bool menu_settings = 6;
    };
    string id = 1;
    string label = 2;
    string type = 3;
    Permission permission = 4;
    google.protobuf.Struct attributes = 5;
}

message GetAllMenuPermissionsRequest {
    string project_id = 1;
    string parent_id = 2;
    string role_id = 3;
}
message GetAllMenuPermissionsResponse {
    repeated MenuPermission menus = 1;
}

message UpdateMenuPermissionsRequest {
    string project_id = 1;
    string role_id = 2;
    repeated MenuPermission menus = 3;
}

message UpdatePermissionsRequest {
    
    message Table {
        message RecordPermission {
            string read = 1;
            string write = 2;
            string update = 3;
            string delete = 4;
            string guid = 5;
            bool is_public = 6;
        }
        message FieldPermission {
            string field_id = 1;
            string guid = 2;
            bool view_permission = 3;
            bool edit_permission = 4;
            string label = 5;
            string table_slug = 6;
        }
        message ViewPermission {
            string guid = 1;
            string label = 2;
            string relation_id = 3;
            bool view_permission = 4;
            bool edit_permission = 5;
            bool create_permission = 6;
            bool delete_permission = 7;
            string table_slug = 8;
        }
        message ActionPermission {
            string guid = 1;
            string custom_event_id = 2;
            bool permission = 3;
            string label = 4;
            string table_slug = 5;
        }
        string id = 1;
        string slug = 2;
        string label = 3;
        RecordPermission record_permissions = 4;
        repeated FieldPermission field_permissions = 5;
        repeated ViewPermission view_permissions = 6;
        repeated ActionPermission action_permissions = 7;
    }
    string project_id = 1;
    string guid = 2;
    bool grant_access = 3;
    Table table = 4;
}

message GetPermissionsByTableSlugRequest {
    string role_id = 1;
    string current_role_id = 2;
    string table_slug = 3;
    string project_id = 4;
}

message GetPermissionsByTableSlugResponse {
    UpdatePermissionsRequest current_user_permission = 1;
    UpdatePermissionsRequest selected_user_permission = 2;
}

message GetTablePermissionRequest {
    string role_id = 1;
    string table_slug = 2;
    string resource_environment_id = 3;
    string method = 4;
}

message GetTablePermissionResponse {
    bool is_have_permission = 1;
}